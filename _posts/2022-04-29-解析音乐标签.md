---
layout: post
title: "音乐标签分类"
subtitle: Music tags category
categories: audio
tags: [ID3, ApeV2, mp3]
banner: "/assets/images/cover/2022-04-29-夜明けより前の君.png"
---

我们经常会听歌，对于一首歌，通常会存在歌名、作者、专辑、封面等信息。

如果我们想要获得这些信息，一方面，我们可以去网上搜索，获取相关信息，并将其归档；另一方面，实际上这些音频文件内部已经存储了相关的歌曲信息，我们只需要读取出来就可以，本文简单介绍了几种常见的歌曲标签标准，用来从歌曲中获取歌曲的相关信息。

<!--more-->

## 1. 概述

最初的音频文件实际上只包含音频文件本身的信息，这就导致，如果没有对音频文件进行很好的归档（比如用数据库存储音频文件的相关信息），在没有音频识别技术的前提下，我们是无法获取这首歌的相关信息的，不知道作者是谁，不知道歌曲名是什么，这显然会带来很多的问题。

比如你听到一段好听的音乐，却除了音乐本身外，一无所知，这显然不是我们想要的结果，所以需要一种技术，将歌曲的相关信息写入到歌曲文件中，这样播放器在播放音乐的时候，便可以解析音乐中的相关信息，进而知道这首音乐的作者，专辑，歌名等信息。

`ID3`，APE便是其中的两个解决方案，它们通过将歌曲的一些信息存入到音频文件中，作为元数据（`metadata`），进而可以被解析。

但是需要明确的一点是，这些标准只是被广泛使用，并不代表所有的音频文件都符合这一标准，可能有的播放器只能解析`ID3V2`标签，而有的播放器只支持`ID3V1`标签。

### 类型及标识

`ID3v1`位于文件的结尾，以字符串`TAG`为标识

`ID3v2`位于文件的开头，长度不固定，以字符串`ID3`为标识

`APEv2`长度和位置都不固定，一般位于`ID3v1`之前，以字符串`APETAGEX`为标识

`Lyrics3v2`位于`ID3v1`之前，`APEv2`(如果存在)之后，以字符串`LYRICSBEGIN`为标识，主要用来存储Lrc类型的歌词文件

常见的标签在音频文件中的位置如下所示

![image-20220429153616997](../assets/images/resource/2022-04-29-解析音乐标签.assets/image-20220429153616997.png)

## 2. `ID3v1`

### 位置

`ID3V1`通过将歌曲的信息写入音频文件的最后128字节，对音频文件进行标识，分为`ID3V1`和`ID3V1.1`两个版本，`ID3V1.1`版本是对`ID3V1`版本的补充。

![image-20220429145742799](../assets/images/resource/2022-04-29-解析音乐标签.assets/image-20220429145742799.png)

### 编码

`ID3v1`使用`ANSI`方式对tag进行编码，

ANSI并不是某一种特定的字符编码，而是在不同的系统中，根据当前系统使用的字符集进行编码，那么写入tag的字符编码就有可能是任意的标准，比如`ASCII`，`UNICODE`，`UTF-8`，`GBK`，`JIS`，`EUC-KR`等编码，所以，读取tag时，需要判断字符的编码格式，这样读出来的内容才不会乱码。

### 结构

`ID3v1`与`ID3v1.1`的具体结构如下所示

```ANSII
 * 标签头 TAG  3byte
 * 标题(Tilte)        30byte
 * 作者(Artist)        30byte
 * 专辑(Album)        30byte
 * 出版年份(Year)     4byte
 * for ID3V1
 *      备注(Comment) 30 byte
 * for ID3V1.1
 *      备注(Comment)        28byte
 *      保留        1byte
 *      音轨(Track)        1byte
 * 流派/类型(Genre)        1byte
```

其中

- 最开始的三个字节一直是TAG，只有存在这个标记，才表明这是一个`ID3V1`或`ID3v1.1`标签

- 对于tag的具体内容，如果某段信息没有被填满，比如标题只有8个字节，那么剩下的22个字节都用零字节进行填充，这样在读取的时候，只要读到零，就代表这段信息已经结束了。

- 由于`ID3V1`里面没有音轨，所以`ID3v1.1`进行了改进，将Comment限制为28个字节，如果第29个字节为零，且第30个字节不为零，那么第30个字节的无符号整型值代表的就是音轨

- 对于Track，由于大多数文件都是以无符号整型值-1作为结尾，所以很多时候，往往无法获取流派的信息

- 其中流派中，无符号整型值对应的流派如下所示

- ```
  0.Blues 1.Classic Rock 2.Country 3.Dance 4.Disco 5.Funk 
  6.Grunge 7.Hip-Hop 8.Jazz 9.Metal 10.New Age 11.Oldies 
  12.Other 13.Pop 14.R&B 15.Rap 16.Reggae 17.Rock 
  18.Techno 19.Industrial 20.Alternative 21.Ska 22.Death Metal 23.Pranks 
  24.Soundtrack 25.Euro-Techno 26.Ambient 27.Trip-Hop 28.Vocal 29.Jazz+Funk 
  30.Fusion 31.Trance 32.Classical 33.Instrumental 34.Acid 35.House 
  36.Game 37.Sound Clip 38.Gospel 39.Noise 40.AlternRock 41.Bass 
  42.Soul 43.Punk 44.Space 45.Meditative 46.Instrumental Pop 47.Instrumental Rock 
  48.Ethnic 49.Gothic 50.Darkwave 51.Techno-Industrial 52.Electronic 53.Pop-Folk 
  54.Eurodance 55.Dream 56.Southern Rock 57.Comedy 58.Cult 59.Gangsta 
  60.Top 40 61.Christian Rap 62.Pop/Funk 63.Jungle 64.Native American 65.Cabaret 
  66.New Wave 67.Psychadelic 68.Rave 69.Showtunes 70.Trailer 71.Lo-Fi 
  72.Tribal 73.Acid Punk 74.Acid Jazz 75.Polka 76.Retro 77.Musical 
  78.Rock & Roll 79.Hard Rock 80.Folk 81.Folk-Rock 82.National Folk 83.Swing 
  84.Fast Fusion 85.Bebob 86.Latin 87.Revival 88.Celtic 89.Bluegrass 
  90.Avantgarde 91.Gothic Rock 92.Progressive Rock 93.Psychedelic Rock 94.Symphonic Rock 95.Slow Rock 
  96.Big Band 97.Chorus 98.Easy Listening 99.Acoustic 100.Humour 101.Speech 
  102.Chanson 103.Opera 104.Chamber Music 105.Sonata 106.Symphony 107.Booty Bass 
  108.Primus 109.Porn Groove 110.Satire 111.Slow Jam 112.Club 113.Tango 
  114.Samba 115.Folklore 116.Ballad 117.Power Ballad 118.Rhythmic Soul 119.Freestyle 
  120.Duet 121.Punk Rock 122.Drum Solo 123.A capella 124.Euro-House 125.Dance Hall 
  126. 
  80 Folk and after  following genres are Winamp extensions 
  Deprecated Gradle features were used in this build, making it incompatible with Gradle 8.0.
  ```

## 3. `ID3V2`

由于`ID3v1`只能存储固定128字节的歌曲信息，所以存储的信息有限，如果想要插入其他的信息，比如封面等，这时候就可以使用`ID3v2`了





## 参考资料

- [ID3TAG](https://mutagen-specs.readthedocs.io/en/latest/id3/id3v2.2.html)
- [ID3 org](https://id3.org/ID3v1)

